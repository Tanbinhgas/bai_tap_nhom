USE [QuanLyNhanVien];
GO

-- 1. XÓA BẢNG LUONG CŨ
IF OBJECT_ID('dbo.Luong', 'U') IS NOT NULL
    DROP TABLE dbo.Luong;
GO

-- TẠO BẢNG LUONG
CREATE TABLE dbo.Luong (
    LuongID INT IDENTITY(1,1) PRIMARY KEY,
    MaNV NVARCHAR(10) NOT NULL,
    LuongCoBan DECIMAL(18,2) NOT NULL,
    PhuCap DECIMAL(18,2) NULL DEFAULT 0,
    GhiChu NVARCHAR(255) NULL,

    CONSTRAINT CK_Luong_CoBan CHECK (LuongCoBan > 0),
    CONSTRAINT CK_Luong_PhuCap CHECK (PhuCap >= 0),
    CONSTRAINT FK_Luong_NhanVien FOREIGN KEY (MaNV) 
        REFERENCES dbo.NhanVien(MaNV)
        ON DELETE CASCADE
);
GO

-- THÊM DỮ LIỆU LƯƠNG
INSERT INTO dbo.Luong (MaNV, LuongCoBan, PhuCap) VALUES
('NV1001', 15000000, 2000000),
('NV1002', 25000000, 3000000),
('NV1003', 12000000, 1500000),
('NV1004', 18000000, 2500000),
('NV1005', 35000000, 5000000),
('NV1006', 14000000, 1000000),
('NV1007', 20000000, 2000000),
('NV1008', 11000000, 800000),
('NV1009',  8000000, 500000),
('NV1010', 30000000, 4000000);
GO

-- XEM BẢNG LƯƠNG
SELECT
    nv.MaNV AS [Mã NV],
    nv.HoTen AS [Họ tên],
    FORMAT(l.LuongCoBan, 'N0') + ' VND' AS [Lương CB],
    FORMAT(ISNULL(l.PhuCap, 0), 'N0') + ' VND' AS [Phụ cấp],
    FORMAT(l.LuongCoBan + ISNULL(l.PhuCap, 0), 'N0') + ' VND' AS [Tổng lương]
FROM dbo.Luong l
INNER JOIN dbo.NhanVien nv ON l.MaNV = nv.MaNV
ORDER BY l.LuongCoBan DESC;